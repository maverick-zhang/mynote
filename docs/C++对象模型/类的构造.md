## 类的构造

------



#### 默认构造函数

当没有定义构造函数时，编译器会产生默认构造函数

- 但实际上编译器只会在必要时产生默认构造函数
- 如果一个没有定义构造函数的类A，其包含一个对象类型成员b(即组合)，这个对象类型成员的类B包含定义的构造函数，那么编译器会构造一个构造函数，在这个构造函数中调用B的构造函数，如果有多个这种对象类型成员，那么他们的构造函数的调用顺序取决于这些对象类型成员的在类A的定义顺序
- 父类带缺省的构造函数，子类没有任何构造函数，编译器也会合成默认构造函数来调用父类的构造函数
- 如果一个类含有虚函数，但没有构造函数时，因为虚函数的存在，编译器会生成虚函数表vft，虚函数表指针指向该表的首地址，这一步操作在类的构造函数中进行，即编译器合成了默认的构造函数。
- 当类有虚基类时(共享父类对象)，编译器会创建虚基类表vbtable，且会为子类和父类都合成了默认的构造函数，用于调用虚函数表的创建以及虚函数表指针的赋值。

当有自定义的构造函数时，编译器也会根据需求扩充构造函数的代码，比如调用父类构造函数，成员类对象的构造函数，虚函数表指针赋值等内容。



#### 拷贝构造函数

如果没有拷贝构造函数，编译器会合成一个拷贝构造函数。

- 同默认构造函数，编译器也只在需要时合成默认拷贝构造函数。
- 当拷贝构造只需要对内置类型的成员变量如int,char等进行赋值时，编译器会执行成员初始化直接进行变量的赋值，而没有拷贝构造函数的调用。
- 如果类中含有类对象成员变量，那么会执行递归拷贝，如果这个类对象成员变量有类的拷贝构造函数（或该类需要编译器生成默认拷贝构造函数），那么编译器会合成拷贝构造函数，以调用类对象成员变量的拷贝构造。
- 父类含有拷贝构造函数(或者需要编译器合成拷贝构造函数)，那么编译器会为子类合成拷贝构造函数。以调用父类的拷贝构造函数
- 如果该类中含有虚函数(声明或继承)，编译器也会合成拷贝构造函数，以完成虚函数表的初始化和指针赋值。
- 该类含有虚基类，同样为了完成虚基类表的初始化和赋值，也需要构造拷贝构造函数



