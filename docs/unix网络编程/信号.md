##  信号

-  可重入函数

  即在信号处理函数中调用该函数是安全的，且是异步信号安全的

  常见的不可重入函数，malloc, printf

  在信号处理函数中，尽量使用简单的语句做简单的事情，尽量不要使用系统函数来避免麻烦，如果必须要使用系统函数，那么要确认该系统函数是可重入的(网上有整理所有的可重入系统函数)

  如果该可重入的系统函数可能会产生信号，那么可以先备份信号值，在信号处理函数之后，再恢复该信号值

### 信号处理函数的书写规则

- 代码尽可能简单，尽快处理完毕，保证不会在信号处理函数上产生阻塞
- 用一些全局量做标记，尽可能不调用函数

- 信号集

  1. 用一组bit代表信号集，每一位代表一种信号，用1表示收到某个信号，0代表没有该信号。内部数据结构实际上是两个无符号long(总共64位)，数据类型为sigset_t。
2. 每一个进程都会有自身的一套信号集，如果把信号集中的屏蔽位设置为1，此时再来相同的信号，那么该信号会被阻塞，不会被传递到进程。这也意味着对于相同的信号，如果当前的信号尚未处理完成，那么后来的信号会被阻塞，直到该信号处理函数执行完毕 ，信号处理完毕后，系统会自动重新设置信号屏蔽集。一个被屏蔽的信号，在被屏蔽的期间如果出现该信号，那么所有该信号会被合并为一个信号，并保存，如果在后面某个时刻该进程的信号集重新设置，该信号不再被屏蔽，那么这个信号会继续传送到进程中。
  3. 如果信号处理期间来了一个新的信号，那么该目前的信号处理会暂停转而去执行新的信号处理程序，在执行之后在继续执行前面的信号处理程序。
4. 可以在处理某信号时，可以设置信号屏蔽防止新信号的处理

  信号集相关函数：

  1. sigemptyset()，把信号集中的所有信号都设置为0
  2. sigfilterset()，把信号集中的所有信号都设置为1
  3. sigaddset()和sigdelset()可以设置某个信号位为1和0
  4. sigprocmask()函数能够设置进程所对应的的信号集中的内容
  5. sigismember()函数可以测试某个信号位是否为1



### sigprocmask

该函数用于设置屏蔽信号集，第一个参数为对信号的操作，SIG_SETMASK，SIG_BLOCK表示对信号集的信号屏蔽，第二个参数为信号集



### singnacation

函数接受三个参数，第一个为信号值，第二个为系统电一的结构，里面包含了该信号处理函数的指针，第三个参数是一个值结果参数，用以保存以前的信号处理函数。

### sigsuspend

接收一个信号集为参数，然后阻塞等待一个信号的到来，此时进程挂起，不占用CPU时间这个函数是一个原子操作，能够保证信号一定能够收到，且收到信号后立即阻塞信号集中的所有信号防止被打断，当收到信号后程序重启. 因此该函数适用于信号驱动的行为



### 